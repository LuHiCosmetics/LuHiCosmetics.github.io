I"¶á<hr />
<p>·ªû b√†i vi·∫øt n√†y, ch√∫ng ta s·∫Ω l√†m vi·ªác v·ªõi code sau khi c√°c b·∫°n ƒë√£ c√†i ƒë·∫∑t c√°c ph·∫ßn m·ªÅm v√† chu·∫©n b·ªã nh·ªØng ph·∫ßn c·ª©ng ·ªü <a href="https://bangnguyendev.github.io/2020-01-17-smart-clock/" title="Ph·∫ßn 1: Gi·ªõi thi·ªáu d·ª± √°n"><strong><code class="language-plaintext highlighter-rouge">Ph·∫ßn 1.</code></strong></a></p>

<p>Repo c√°c b·∫°n c√≥ th·ªÉ nh·∫•n v√†o c√°c <kbd>Button Github</kbd> ·ªü ƒë·∫ßu b√†i (<kbd>star</kbd>, <kbd>watch</kbd>, <kbd>fork</kbd>, <kbd>follow</kbd>) ƒë·ªÉ Clone Repo v·ªÅ m√°y t√≠nh c√° nh√¢n. N·∫øu m√°y c√°c b·∫°n kh√¥ng hi·ªán ra th√¨ c√≥ th·ªÉ <a href="https://github.com/bangnguyendev/SmartClock/" title="Smart Clock">nh·∫•n ·ªü ƒë√¢y ƒë·ªÉ</a> truy c·∫≠p Repo.</p>

<p class="box-note"><strong>Khuy√™n d√πng</strong>: S·ª≠ d·ª•ng <code class="language-plaintext highlighter-rouge">Git</code> (GitHub Desktop, GitLab), <code class="language-plaintext highlighter-rouge">TortoiseGit</code> ƒë·ªÉ l∆∞u tr·ªØ &amp; Clone Repo v·ªÅ.</p>

<h3 id="ƒë·∫£m-b·∫£o-k·∫øt-n·ªëi-wifi-d·ªÖ-d√†ng-cho-thi·∫øt-b·ªã-·ªü-ƒë√¢y-l√†-ƒë·ªìng-h·ªì">ƒê·∫£m b·∫£o k·∫øt n·ªëi wifi d·ªÖ d√†ng cho thi·∫øt b·ªã (·ªü ƒë√¢y l√† ƒë·ªìng h·ªì)</h3>
<p>Kh√¥ng ri√™ng g√¨ d·ª± √°n n√†y, ·ªü m·ªôt s·ªë d·ª± √°n IoT n·∫øu mu·ªën thi·∫øt b·ªã c·ªßa ch√∫ng ta linh ƒë·ªông h∆°n trong k·∫øt n·ªëi Wifi th√¨ gi·∫£i ph√°p ƒë∆∞·ª£c ƒë·ªÅ c·∫≠p ƒë·∫øn l√† <code class="language-plaintext highlighter-rouge">SmartConfig</code> (xem l·∫°i ph·∫ßn 1 ch√∫ng ta ƒë√£ gi·ªõi thi·ªáu).</p>
<ul>
  <li>ƒê·∫ßu ti√™n ch√∫ng ta c·∫ßn 1 c√°i <code class="language-plaintext highlighter-rouge">Smartphone</code> (m√°y t√≠nh b·∫£ng g√¨ c·ªßng ƒë∆∞·ª£c - thu ph√°t ƒë∆∞·ª£c s√≥ng wifi 2.4GHz l√† ƒë∆∞·ª£c) ƒë·ªÉ c√†i ·ª©ng d·ª•ng <code class="language-plaintext highlighter-rouge">Smartconfig</code>.
    <ul>
      <li>Link t·∫£i <a href="https://www.espressif.com/en/products/software/esp-touch/resources"><strong><code class="language-plaintext highlighter-rouge">app ch√≠nh h√£ng</code></strong></a> t·ª´ ESP bao g·ªìm <code class="language-plaintext highlighter-rouge">IOS</code> &amp; <code class="language-plaintext highlighter-rouge">Android Code</code>. T·∫£i app ·ªü link n√†y v·ªÅ ƒë·ªÉ c√°c b·∫°n c√≥ th·ªÉ t√πy <strong>bi·∫øn l·∫°i giao di·ªán</strong> app n·∫øu d√πng Android Studio.
<img src="/img/2020-01-23-smart-clock/APK_APP_SMARTCONFIG.png" alt="H√¨nh ·∫£nh m√¥ t·∫£" title="V√†o m·ª•c APKs ƒë·ªÉ t·∫£i ·ª©ng d·ª•ng" class="center-block" /></li>
      <li><code class="language-plaintext highlighter-rouge">Android</code> t·∫£i v·ªÅ d√πng lu√¥n: <a href="https://play.google.com/store/apps/details?id=com.cmmakerclub.iot.esptouch&amp;hl=vi">ESP8266 SmartConfig</a>, <a href="https://play.google.com/store/apps/details?id=com.iotmaker&amp;hl=vi">IoT Smartconfig</a>.</li>
      <li><code class="language-plaintext highlighter-rouge">IOS</code> t·∫£i v·ªÅ d√πng lu√¥n: <a href="https://apps.apple.com/us/app/espressif-esptouch/id1071176700">Espressif Esptouch</a></li>
      <li>C√†i tr∆∞·ªõc ƒëi nha, h∆∞·ªõng d·∫´n s·ª≠ d·ª•ng sau.</li>
    </ul>
  </li>
  <li>V√†o code, ch√∫ng ta l√†m theo <code class="language-plaintext highlighter-rouge">quy tr√¨nh</code> sau:
    <ul>
      <li><strong>B∆∞·ªõc 1.</strong> Thi·∫øt b·ªã s·∫Ω <code class="language-plaintext highlighter-rouge">kh·ªüi ƒë·ªông</code>.</li>
      <li><strong>B∆∞·ªõc 2.</strong> Qu√° tr√¨nh ƒë·ªçc <code class="language-plaintext highlighter-rouge">ssid v√† pass wifi</code> s·∫Ω ƒë∆∞·ª£c l·∫•y <code class="language-plaintext highlighter-rouge">trong b·ªô nh·ªõ EEPROM</code> (v·ªõi Wemos D1 mini m·ªõi mua v·ªÅ th√¨ b∆∞·ªõc ƒë·ªçc b·ªô nh·ªõ n√†y s·∫Ω cho ra k·∫øt qu·∫£ r·ªóng - k·∫øt qu·∫£ r·ªóng th√¨ b∆∞·ªõc ƒëƒÉng nh·∫≠p wifi s·∫Ω kh√¥ng ƒë∆∞·ª£c - Wemos D1 mini s·∫Ω v√†o <code class="language-plaintext highlighter-rouge">B∆∞·ªõc 4</code>).</li>
      <li><strong>B∆∞·ªõc 3.</strong> S·ª≠ d·ª•ng ssid v√† pass v·ª´a ƒë·ªçc ra ƒë·ªÉ <code class="language-plaintext highlighter-rouge">k·∫øt n·ªëi wifi</code>.</li>
      <li><strong>B∆∞·ªõc 4.</strong> N·∫øu trong th·ªùi gian quy ƒë·ªãnh m√† vi·ªác k·∫øt n·ªëi v·∫´n <code class="language-plaintext highlighter-rouge">kh√¥ng th√†nh c√¥ng</code> th√¨ s·∫Ω nh·∫£y v√†o qu√° tr√¨nh <code class="language-plaintext highlighter-rouge">Smartconfig</code>.</li>
      <li><strong>B∆∞·ªõc 5.</strong> <code class="language-plaintext highlighter-rouge">Timeout Smartconfig</code> ch√∫ng ta ƒë·∫∑t ra l√† <code class="language-plaintext highlighter-rouge">100 gi√¢y</code> (c√°c b·∫°n mu·ªën bao nhi√™u gi√¢y th√¨ ch·ªânh l·∫°i, ri√™ng m√¨nh th·∫•y 100s l√† h·ª£p l√≠ sau bao nhi√™u l·∫ßn th·ª≠ nghi·ªám).</li>
      <li><strong>B∆∞·ªõc 6.</strong> Trong th·ªùi gian 100 gi√¢y ch√∫ng ta <code class="language-plaintext highlighter-rouge">m·ªü ·ª©ng d·ª•ng tr√™n ƒëi·ªán tho·∫°i</code>, l√∫c n√†y m√†n h√¨nh giao di·ªán s·∫Ω y√™u c·∫ßu ch√∫ng ta nh·∫≠p ssid v√† pass cho Wemos D1 mini l·∫•y data k·∫øt n·ªëi, n·∫øu <code class="language-plaintext highlighter-rouge">k·∫øt n·ªëi th√†nh c√¥ng</code> th√¨ ssid v√† pass s·∫Ω ƒë∆∞·ª£c <code class="language-plaintext highlighter-rouge">l∆∞u v√†o EEPROM</code>.</li>
      <li><strong>B∆∞·ªõc 7.</strong> N·∫øu <code class="language-plaintext highlighter-rouge">kh√¥ng th√†nh c√¥ng</code> sau 100 gi√¢y thi·∫øt b·ªã s·∫Ω <code class="language-plaintext highlighter-rouge">kh·ªüi ƒë·ªông l·∫°i</code> v√† b·∫Øt ƒë·∫ßu quy tr√¨nh ƒë·∫ßu ti√™n.</li>
    </ul>

    <p><img src="/img/2020-01-23-smart-clock/SSID_PASS_EEPROM_Diagram.png" alt="L∆∞u ƒê·ªì Gi·∫£i Thu·∫≠t" title="L∆∞u ƒê·ªì Gi·∫£i Thu·∫≠t - Draw.io" class="center-block" /></p>
  </li>
  <li><a href="/documents/2020-01-23-smart-clock/Code-Smartconfig/Smartconfig.ino" title="Source Code"><code class="language-plaintext highlighter-rouge">Code gi√∫p ESP8266</code></a> - Wemos D1 mini c√≥ kh·∫£ nƒÉng l∆∞u tr·ªØ v√† thay ƒë·ªïi wifi:</li>
</ul>

<figure class="highlight"><pre><code class="language-c" data-lang="c"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
</pre></td><td class="code"><pre><span class="cp">#include &lt;ESP8266WiFi.h&gt;
#include &lt;Wire.h&gt;
#include &lt;EEPROM.h&gt;
#define ESP_NB_ZERO 0
#define ESP_NB_ONE 1
#define ESP_NB_OFF 0
#define ESP_NB_ON 1
</span><span class="cm">/*index 0 to 31 */</span>
<span class="cp">#define index_eeprom_SSID 32
</span><span class="cm">/*index 32 to 95 */</span>
<span class="cp">#define index_eeprom_PASS 96
</span><span class="cm">/*index 0 to 95 */</span>
<span class="cp">#define index_eeprom_WIFI 96
</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">ssid</span> <span class="o">=</span> <span class="s">"nguyenduybang"</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">passphrase</span> <span class="o">=</span> <span class="s">"nguyenduybang"</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span>
<span class="p">{</span>
  <span class="cm">/* Initialize Serial. */</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span>
  <span class="cm">/* Initialize eeprom */</span>
  <span class="n">EEPROM</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">512</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"=========ƒê·ªåC SSID PASS T·ª™ EEROM ƒê√É L∆ØU!!!===="</span><span class="p">);</span>
  <span class="cm">/* read eeprom for ssid and pass */</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"Reading EEPROM ssid"</span><span class="p">);</span>
  <span class="n">String</span> <span class="n">esid</span> <span class="o">=</span> <span class="s">""</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">index_eeprom_SSID</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">esid</span> <span class="o">+=</span> <span class="kt">char</span><span class="p">(</span><span class="n">EEPROM</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">i</span><span class="p">));</span>
  <span class="p">}</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"SSID: "</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">esid</span><span class="p">);</span>

  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">" "</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"Reading EEPROM pass"</span><span class="p">);</span>
  <span class="n">String</span> <span class="n">epass</span> <span class="o">=</span> <span class="s">""</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">32</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">index_eeprom_PASS</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">epass</span> <span class="o">+=</span> <span class="kt">char</span><span class="p">(</span><span class="n">EEPROM</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">i</span><span class="p">));</span>
  <span class="p">}</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"PASS: "</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">epass</span><span class="p">);</span>
  
  <span class="cm">/* nho check lai dieu kien cho nay khi &lt; 1 */</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">esid</span><span class="p">.</span><span class="n">length</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">ESP_NB_ONE</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">WiFi</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="n">WIFI_STA</span><span class="p">);</span>
    <span class="n">WiFi</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="n">esid</span><span class="p">.</span><span class="n">c_str</span><span class="p">(),</span> <span class="n">epass</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">testWifi</span><span class="p">())</span>
    <span class="p">{</span>
      <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"Vao test wifi ok!"</span><span class="p">);</span>
      <span class="n">delay</span><span class="p">(</span><span class="mi">1500</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="c1">//! KH√îNG TH·ªÇ K·∫æT N·ªêI</span>
    <span class="p">{</span>
      <span class="n">delay</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
      <span class="cm">/* v√†o t√¨m k·∫øt n·ªëi wifi*/</span>
      <span class="n">smartConfig_ndb</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="cm">/* n·∫øu SSID nh·ªè h∆°n 0... th√¨ y√™u c·∫ßu k·∫øt n·ªëi wifi*/</span>
  <span class="k">else</span>
  <span class="p">{</span>
    <span class="n">smartConfig_ndb</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="n">WiFi</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="n">WIFI_STA</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">""</span><span class="p">);</span>
  <span class="n">WiFi</span><span class="p">.</span><span class="n">printDiag</span><span class="p">(</span><span class="n">Serial</span><span class="p">);</span>
  <span class="c1">// In ƒë·ªãa ch·ªâ IP</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">""</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"WiFi connected"</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"IP address: "</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">WiFi</span><span class="p">.</span><span class="n">localIP</span><span class="p">());</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">smartConfig_ndb</span><span class="p">()</span>
<span class="p">{</span>
  <span class="c1">//Mode wifi l√† station</span>
  <span class="n">WiFi</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="n">WIFI_STA</span><span class="p">);</span>
  <span class="n">WiFi</span><span class="p">.</span><span class="n">beginSmartConfig</span><span class="p">();</span>
  <span class="kt">int</span> <span class="n">dem</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
  <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">delay</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
    <span class="n">dem</span><span class="o">--</span><span class="p">;</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">dem</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">dem</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="c1">//! neu qua 100s ma chua co ket noi nao thi restart lai esp</span>
    <span class="p">{</span>
      <span class="n">delay</span><span class="p">(</span><span class="mi">2000</span><span class="p">);</span>
      <span class="n">ESP</span><span class="p">.</span><span class="n">restart</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="c1">//Ki·ªÉm tra k·∫øt n·ªëi th√†nh c√¥ng in th√¥ng b√°o</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">WiFi</span><span class="p">.</span><span class="n">smartConfigDone</span><span class="p">())</span>
    <span class="p">{</span>
      <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"SmartConfig Success"</span><span class="p">);</span>
      <span class="n">String</span> <span class="n">qsid</span> <span class="o">=</span> <span class="n">WiFi</span><span class="p">.</span><span class="n">SSID</span><span class="p">();</span>
      <span class="n">String</span> <span class="n">qpass</span> <span class="o">=</span> <span class="n">WiFi</span><span class="p">.</span><span class="n">psk</span><span class="p">();</span>
      <span class="n">delay</span><span class="p">(</span><span class="mi">5000</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">qsid</span><span class="p">.</span><span class="n">length</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">qpass</span><span class="p">.</span><span class="n">length</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
      <span class="p">{</span>
        <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"clearing eeprom"</span><span class="p">);</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">96</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
        <span class="p">{</span>
          <span class="n">EEPROM</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">qsid</span><span class="p">);</span>
        <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">""</span><span class="p">);</span>
        <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">qpass</span><span class="p">);</span>
        <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">""</span><span class="p">);</span>

        <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"writing eeprom ssid:"</span><span class="p">);</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">qsid</span><span class="p">.</span><span class="n">length</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
        <span class="p">{</span>
          <span class="n">EEPROM</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">qsid</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
          <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"Wrote: "</span><span class="p">);</span>
          <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">qsid</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
        <span class="p">}</span>
        <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"writing eeprom pass:"</span><span class="p">);</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">qpass</span><span class="p">.</span><span class="n">length</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
        <span class="p">{</span>
          <span class="n">EEPROM</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="mi">32</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="n">qpass</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
          <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"Wrote: "</span><span class="p">);</span>
          <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">qpass</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
        <span class="p">}</span>
        <span class="n">EEPROM</span><span class="p">.</span><span class="n">commit</span><span class="p">();</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="n">bool</span> <span class="nf">testWifi</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">c</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">""</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"Waiting for Wifi to connect"</span><span class="p">);</span>
  <span class="k">while</span> <span class="p">(</span><span class="n">c</span> <span class="o">&lt;</span> <span class="mi">40</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">WiFi</span><span class="p">.</span><span class="n">status</span><span class="p">()</span> <span class="o">==</span> <span class="n">WL_CONNECTED</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">delay</span><span class="p">(</span><span class="mi">300</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">WiFi</span><span class="p">.</span><span class="n">status</span><span class="p">());</span>
    <span class="cm">/**
      typedef enum {
        WL_NO_SHIELD        = 255,   // for compatibility with WiFi Shield library
        WL_IDLE_STATUS      = 0,
        WL_NO_SSID_AVAIL    = 1,
        WL_SCAN_COMPLETED   = 2,
        WL_CONNECTED        = 3,
        WL_CONNECT_FAILED   = 4,
        WL_CONNECTION_LOST  = 5,
        WL_DISCONNECTED     = 6
      } wl_status_t;
    **/</span>
    <span class="n">c</span><span class="o">++</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">""</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"Connect timed out, opening AP"</span><span class="p">);</span>
  <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span>
<span class="p">{</span>
<span class="p">}</span>

<span class="p">...</span>
</pre></td></tr></tbody></table></code></pre></figure>

<ul>
  <li><kbd>void smartConfig_ndb()</kbd> trong ƒëo·∫°n code tr√™n m√¨nh t·∫°o m·ªôt h√†m ri√™ng , trong qu√° tr√¨nh s·ª≠ d·ª•ng thi·∫øt b·ªã n·∫øu ch√∫ng ta <code class="language-plaintext highlighter-rouge">mu·ªën thay ƒë·ªïi wifi</code> th√¨ ch·ªâ vi·ªác g·ªçi h√†m n√†y ra.</li>
  <li><strong>S·ª≠ d·ª•ng ·ª©ng d·ª•ng Smartconfig</strong>: khi <code class="language-plaintext highlighter-rouge">Wemos D1 mini</code> v√†o ch·∫ø ƒë·ªô <code class="language-plaintext highlighter-rouge">Smartconfig</code> ch√∫ng ta m·ªü ƒëi·ªán tho·∫°i ƒë√£ c√†i ƒë·∫∑t th√†nh c√¥ng ·ª©ng d·ª•ng, nh·∫≠p d·ªØ li·ªáu t√™n wifi v√† pass v√† nh·∫•n <strong><code class="language-plaintext highlighter-rouge">Comfirm</code></strong> - h√¨nh ·∫£nh minh h·ªça ph√≠a d∆∞·ªõi. 
  <img src="/img/2020-01-23-smart-clock/Help_smartconfig.png" alt="H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng ·ª©ng d·ª•ng" title="Qu√° tr√¨nh k·∫øt n·ªëi Smartconfig qua ph∆∞∆°ng th·ª©c ESPTouch" class="center-block" /></li>
</ul>

<h3 id="ƒë·ªìng-b·ªô-th·ªùi-gian-t·ª´-poolntporg">ƒê·ªìng b·ªô th·ªùi gian t·ª´ pool.ntp.org</h3>

<p><img src="/img/2020-01-23-smart-clock/ntp_sever.jpg" alt="ntp sever" class="center-block img-rounded" /></p>

<figure class="highlight"><pre><code class="language-c" data-lang="c"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
</pre></td><td class="code"><pre><span class="cp">#include "time.h"
</span>
<span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">ntpServer</span> <span class="o">=</span> <span class="s">"pool.ntp.org"</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">long</span>  <span class="n">gmtOffset_sec</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span>   <span class="n">daylightOffset_sec</span> <span class="o">=</span> <span class="mi">3600</span><span class="p">;</span>

<span class="cm">/*
  %a Abbreviated weekday name
  %A Full weekday name
  %b Abbreviated month name
  %B Full month name
  %c Date and time representation for your locale
  %d Day of month as a decimal number (01-31)
  %H Hour in 24-hour format (00-23)
  %I Hour in 12-hour format (01-12)
  %j Day of year as decimal number (001-366)
  %m Month as decimal number (01-12)
  %M Minute as decimal number (00-59)
  %p Current locale's A.M./P.M. indicator for 12-hour clock
  %S Second as decimal number (00-59)
  %U Week of year as decimal number,  Sunday as first day of week (00-51)
  %w Weekday as decimal number (0-6; Sunday is 0)
  %W Week of year as decimal number, Monday as first day of week (00-51)
  %x Date representation for current locale
  %X Time representation for current locale
  %y Year without century, as decimal number (00-99)
  %Y Year with century, as decimal number
  %z %Z Time-zone name or abbreviation, (no characters if time zone is unknown)
  %% Percent sign
  You can include text literals (such as spaces and colons) to make a neater display or for padding between adjoining columns.
  You can suppress the display of leading zeroes  by using the "#" character  (%#d, %#H, %#I, %#j, %#m, %#M, %#S, %#U, %#w, %#W, %#y, %#Y)
*/</span>

<span class="kt">void</span> <span class="nf">printLocalTime</span><span class="p">()</span>
<span class="p">{</span>
  <span class="k">struct</span> <span class="n">tm</span> <span class="n">timeinfo</span><span class="p">;</span>
  <span class="n">configTime</span><span class="p">(</span><span class="n">gmtOffset_sec</span><span class="p">,</span> <span class="n">daylightOffset_sec</span><span class="p">,</span> <span class="n">ntpServer</span><span class="p">);</span>

  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">getLocalTime</span><span class="p">(</span><span class="o">&amp;</span><span class="n">timeinfo</span><span class="p">))</span>
  <span class="p">{</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="s">" Failed to obtain time"</span><span class="p">));</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="o">&amp;</span><span class="n">timeinfo</span><span class="p">,</span> <span class="s">" %d %B %Y %H:%M:%S "</span><span class="p">);</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></figure>

<ul>
  <li>Tham kh·∫£o c√°ch hi·ªÉn th·ªã th·ªùi gian <a href="/documents/2020-01-23-smart-clock/ntp-time/Gravity_date_codes.pdf">t·∫°i ƒë√¢y</a>.</li>
  <li>
    <p>Sau khi hi·ªÉu c√°ch th·ª©c ho·∫°t ƒë·ªông v√† l·∫•y th√¥ng tin th·ªùi gian c·∫ßn thi·∫øt cho d·ª± √°n c·ªßa m√¨nh, vi·ªác ti·∫øp theo ch√∫ng ta c·∫ßn quan t√¢m l√† l·ª±a ch·ªçn v√† s·∫Øp x·∫øp b·ªë c·ª•c th√¥ng tin th·ªùi gian tr√™n LCD 20x04.</p>

    <p><img src="/img/2020-01-23-smart-clock/gio-nhietdo-dam.jpg" alt="gio-nhietdo-dam" title="Hi·ªÉn th·ªã gi·ªù, nhi·ªát ƒë·ªô, ƒë·ªô ·∫©m, gi·ªù b√°o th·ª©c, ƒë·ªãa ph∆∞∆°ng" class="center-block img-rounded" /></p>

    <p><img src="/img/2020-01-23-smart-clock/gio-thu-ngay-thang-nam.jpg" alt="gio-thu-ngay-thang-nam" title="Hi·ªÉn th·ªã th·ª©, gi·ªù, ng√†y, th√°ng, nƒÉm" class="center-block img-rounded" /></p>
  </li>
</ul>

<blockquote>
  <p>ƒê√¢y l√† c√°ch m√¨nh b·ªë tr√≠ hi·ªÉn th·ªã th√¥ng tin th·ªùi gian v√† m·ªôt v√†i th·ª© kh√°c. C√°c giao di·ªán tr√™n ƒë∆∞·ª£c m√¨nh thay ƒë·ªïi m·ªói 5 gi√¢y.</p>
</blockquote>

<p>Tr√≠ch ƒëo·∫°n <strong>l∆∞u ƒë·ªì</strong> v√† <strong>code</strong> ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ <code class="language-plaintext highlighter-rouge">hi·ªÉn th·ªã</code> 2 m√†n h√¨nh tr√™n:</p>

<p><img src="/img/2020-01-23-smart-clock/hien-thi-thoi-gian-Diagram.png" alt="L∆∞u ƒë·ªì hi·ªÉn th·ªã" class="center-block img-rounded" /></p>

<figure class="highlight"><pre><code class="language-c" data-lang="c"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
</pre></td><td class="code"><pre><span class="p">...</span>
<span class="k">if</span> <span class="p">(</span><span class="n">giay</span> <span class="o">/</span> <span class="mi">1</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">)</span>
<span class="cm">/* M·ªói ch·∫ø ƒë·ªô hi·ªÉn th·ªã 5 gi√¢y */</span>
<span class="p">{</span>
  <span class="cm">/* Ch·ªâ hi·ªÉn th·ªã v√†o ng√†y sinh nh·∫≠t Dung */</span>
  <span class="k">if</span> <span class="p">((</span><span class="n">ngay</span> <span class="o">==</span> <span class="n">DAY_DungNguyen</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">thang</span> <span class="o">==</span> <span class="n">MON_DungNguyen</span><span class="p">))</span>
  <span class="p">{</span>
    <span class="n">lcd</span><span class="p">.</span><span class="n">setCursor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">lcd</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"Dung Cute!"</span><span class="p">);</span>
    <span class="n">lcd</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"HPBD!"</span><span class="p">);</span>
    <span class="k">static</span> <span class="kt">int</span> <span class="n">age_of_MsDung</span><span class="p">;</span>
    <span class="n">age_of_MsDung</span> <span class="o">=</span> <span class="n">nam</span> <span class="o">-</span> <span class="mi">1994</span><span class="p">;</span>
    <span class="n">lcd</span><span class="p">.</span><span class="n">setCursor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">lcd</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"Dung tron "</span><span class="p">);</span>
    <span class="n">lcd</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">age_of_MsDung</span><span class="p">);</span>
    <span class="n">lcd</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">" tuoi."</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"Sanh th·∫ßn Dung ng√°o :3"</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="cm">/* Hi·ªÉn th·ªã c√°c ng√†y b√¨nh th∆∞·ªùng */</span>
  <span class="k">else</span>
  <span class="p">{</span>
    <span class="n">lcd</span><span class="p">.</span><span class="n">setCursor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">lcd</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="cm">/* Canh gi·ªØa m√†n h√¨nh c√°c hi·ªÉn th·ªã Th·ª© */</span>
    <span class="cm">/* Sunday Monday Friday*/</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">thu</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">thu</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">thu</span> <span class="o">==</span> <span class="mi">5</span><span class="p">))</span>
    <span class="p">{</span>
      <span class="n">lcd</span><span class="p">.</span><span class="n">setCursor</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
      <span class="n">lcd</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">buffer_THU</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="cm">/* Tuesday   */</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">thu</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">lcd</span><span class="p">.</span><span class="n">setCursor</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
      <span class="n">lcd</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">buffer_THU</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="cm">/* Thursday Saturday  */</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">((</span><span class="n">thu</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">thu</span> <span class="o">==</span> <span class="mi">6</span><span class="p">))</span>
    <span class="p">{</span>
      <span class="n">lcd</span><span class="p">.</span><span class="n">setCursor</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
      <span class="n">lcd</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">buffer_THU</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="cm">/* Wednesday  */</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">thu</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">lcd</span><span class="p">.</span><span class="n">setCursor</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
      <span class="n">lcd</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">buffer_THU</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="cm">/* */</span>
    <span class="n">lcd</span><span class="p">.</span><span class="n">setCursor</span><span class="p">(</span><span class="mi">19</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">lcd</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>

    <span class="n">lcd</span><span class="p">.</span><span class="n">setCursor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">lcd</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>

    <span class="cm">/*  *___XX_May_2019____* */</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">thang</span> <span class="o">==</span> <span class="mi">5</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">lcd</span><span class="p">.</span><span class="n">setCursor</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
      <span class="n">lcd</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">buffer_N_T_N</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="cm">/*  *___XX_June_2019___*
    July  */</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">((</span><span class="n">thang</span> <span class="o">==</span> <span class="mi">6</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">thang</span> <span class="o">==</span> <span class="mi">7</span><span class="p">))</span>
    <span class="p">{</span>
      <span class="n">lcd</span><span class="p">.</span><span class="n">setCursor</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
      <span class="n">lcd</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">buffer_N_T_N</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="cm">/*  *__XX_March_2019___*
    April  */</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">((</span><span class="n">thang</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">thang</span> <span class="o">==</span> <span class="mi">4</span><span class="p">))</span>
    <span class="p">{</span>
      <span class="n">lcd</span><span class="p">.</span><span class="n">setCursor</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
      <span class="n">lcd</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">buffer_N_T_N</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="cm">/*  *__XX_August_2019__* */</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">thang</span> <span class="o">==</span> <span class="mi">8</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">lcd</span><span class="p">.</span><span class="n">setCursor</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
      <span class="n">lcd</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">buffer_N_T_N</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="cm">/*  *_XX_January_2019__*
    October */</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">((</span><span class="n">thang</span> <span class="o">==</span> <span class="mi">10</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">thang</span> <span class="o">==</span> <span class="mi">1</span><span class="p">))</span>
    <span class="p">{</span>
      <span class="n">lcd</span><span class="p">.</span><span class="n">setCursor</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
      <span class="n">lcd</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">buffer_N_T_N</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="cm">/*  *_XX_February_2019_*
    November December  */</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">((</span><span class="n">thang</span> <span class="o">==</span> <span class="mi">11</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">thang</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">thang</span> <span class="o">==</span> <span class="mi">12</span><span class="p">))</span>
    <span class="p">{</span>
      <span class="n">lcd</span><span class="p">.</span><span class="n">setCursor</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
      <span class="n">lcd</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">buffer_N_T_N</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="cm">/* *_XX_September_2019* */</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">thang</span> <span class="o">==</span> <span class="mi">9</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">lcd</span><span class="p">.</span><span class="n">setCursor</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
      <span class="n">lcd</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">buffer_N_T_N</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">lcd</span><span class="p">.</span><span class="n">setCursor</span><span class="p">(</span><span class="mi">19</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">lcd</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="k">else</span>
<span class="cm">/* Hi·ªÉn th·ªã th·ªùi ti·∫øt */</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">temp</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">lcd</span><span class="p">.</span><span class="n">setCursor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">lcd</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"WL_CONNECTION_LOST"</span><span class="p">);</span>
    <span class="n">lcd</span><span class="p">.</span><span class="n">setCursor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">lcd</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"time.nist.gov LOST"</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">else</span>
  <span class="p">{</span>

    <span class="n">lcd</span><span class="p">.</span><span class="n">setCursor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">lcd</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="n">lcd</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">hen_gio</span> <span class="o">/</span> <span class="mi">10</span> <span class="o">%</span> <span class="mi">10</span><span class="p">);</span>
    <span class="n">lcd</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">hen_gio</span> <span class="o">/</span> <span class="mi">1</span> <span class="o">%</span> <span class="mi">10</span><span class="p">);</span>
    <span class="n">lcd</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">":"</span><span class="p">);</span>
    <span class="n">lcd</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">hen_phut</span> <span class="o">/</span> <span class="mi">10</span> <span class="o">%</span> <span class="mi">10</span><span class="p">);</span>
    <span class="n">lcd</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">hen_phut</span> <span class="o">/</span> <span class="mi">1</span> <span class="o">%</span> <span class="mi">10</span><span class="p">);</span>
    <span class="n">lcd</span><span class="p">.</span><span class="n">setCursor</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">lcd</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
    <span class="n">lcd</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
    <span class="n">lcd</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="n">lcd</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"  H: "</span><span class="p">);</span>
    <span class="n">lcd</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">humidity</span><span class="p">);</span>
    <span class="n">lcd</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"%"</span><span class="p">);</span>
    <span class="n">lcd</span><span class="p">.</span><span class="n">setCursor</span><span class="p">(</span><span class="mi">19</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">lcd</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>

    <span class="n">lcd</span><span class="p">.</span><span class="n">setCursor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">lcd</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">value_Location_EEPROM</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">lcd</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"TpHcm"</span><span class="p">);</span> <span class="cm">/* chuyen thanh location */</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">value_Location_EEPROM</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">lcd</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"VgTau"</span><span class="p">);</span> <span class="cm">/* chuyen thanh location */</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">value_Location_EEPROM</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">lcd</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"DaLat"</span><span class="p">);</span> <span class="cm">/* chuyen thanh location */</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">value_Location_EEPROM</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">lcd</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"TpHue"</span><span class="p">);</span> <span class="cm">/* chuyen thanh location */</span>
    <span class="p">}</span>
    <span class="n">lcd</span><span class="p">.</span><span class="n">setCursor</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">lcd</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
    <span class="n">lcd</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="n">lcd</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
    <span class="n">lcd</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"T: "</span><span class="p">);</span>
    <span class="n">lcd</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">temp</span><span class="p">);</span>
    <span class="n">lcd</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"*C"</span><span class="p">);</span>
    <span class="n">lcd</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="cm">/* Hi·ªÉn th·ªã gi·ªù Font s·ªë l·ªõn */</span>
<span class="n">printDigits</span><span class="p">(</span><span class="n">gio</span> <span class="o">/</span> <span class="mi">10</span> <span class="o">%</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
<span class="n">printDigits</span><span class="p">(</span><span class="n">gio</span> <span class="o">/</span> <span class="mi">1</span> <span class="o">%</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
<span class="cm">/* Hi·ªÉn th·ªã d·∫•u 2 ch·∫•m gi·ªù &amp; ph√∫t */</span>
<span class="k">if</span> <span class="p">(</span><span class="n">giay</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">lcd</span><span class="p">.</span><span class="n">setCursor</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
  <span class="n">lcd</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
  <span class="n">lcd</span><span class="p">.</span><span class="n">setCursor</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
  <span class="n">lcd</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">else</span>
<span class="p">{</span>
  <span class="n">lcd</span><span class="p">.</span><span class="n">setCursor</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
  <span class="n">lcd</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
  <span class="n">lcd</span><span class="p">.</span><span class="n">setCursor</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
  <span class="n">lcd</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
<span class="cm">/* Hi·ªÉn th·ªã ph√∫t Font s·ªë l·ªõn */</span>
<span class="n">printDigits</span><span class="p">(</span><span class="n">phut</span> <span class="o">/</span> <span class="mi">10</span> <span class="o">%</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
<span class="n">printDigits</span><span class="p">(</span><span class="n">phut</span> <span class="o">/</span> <span class="mi">1</span> <span class="o">%</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
<span class="cm">/* Hi·ªÉn th·ªã gi√¢y */</span>
<span class="n">lcd</span><span class="p">.</span><span class="n">setCursor</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
<span class="n">lcd</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">":"</span><span class="p">);</span>
<span class="n">lcd</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">buffer_GIAY</span><span class="p">);</span>
<span class="p">...</span>
</pre></td></tr></tbody></table></code></pre></figure>

<h3 id="ƒë·ªìng-b·ªô-th·ªùi-ti·∫øt-t·ª´-openweathermap">ƒê·ªìng b·ªô th·ªùi ti·∫øt t·ª´ OpenWeatherMap</h3>

<p>·ªû ph·∫ßn l·∫•y d·ªØ li·ªáu th·ªùi ti·∫øt ho·∫°t ƒë·ªông theo chu tr√¨nh:</p>
<ul>
  <li>Kh·ªüi ƒë·ªông thi·∫øt b·ªã v√† ƒë·ªçc v·ªã tr√≠ l∆∞u ·ªü EEPROM</li>
  <li>S·ª≠ d·ª•ng v·ªã tr√≠ ƒë√£ l∆∞u ƒë·ªÉ c·∫≠p nh·∫≠p th·ªùi ti·∫øt</li>
  <li>C·ª© m·ªói 10 ph√∫t ch√∫ng ta s·∫Ω update d·ªØ li·ªáu th·ªùi ti·∫øt t·∫°i v·ªã tr√≠ ƒëang set tr∆∞·ªõc ƒë√≥ qua h√†m <code class="language-plaintext highlighter-rouge">Call_Weather_Every_10Min()</code></li>
</ul>

<figure class="highlight"><pre><code class="language-c" data-lang="c"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="code"><pre><span class="cm">/* H√†m g·ªçi th·ªùi ti·∫øt m·ªói 10 ph√∫t m·ªôt l·∫ßn */</span>
<span class="kt">void</span> <span class="nf">Call_Weather_Every_10Min</span><span class="p">()</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">((</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)(</span><span class="n">millis</span><span class="p">()</span> <span class="o">-</span> <span class="n">time_dem_thoitiet</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span> <span class="c1">//10 phut/ lan</span>
  <span class="p">{</span>
    <span class="n">time_dem_thoitiet</span> <span class="o">=</span> <span class="n">millis</span><span class="p">();</span>
    <span class="n">Weather_Online_sever</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></figure>

<ul>
  <li>Trong qu√° tr√¨nh s·ª≠ d·ª•ng n·∫øu ch√∫ng ta mu·ªën thay ƒë·ªïi v·ªã tr√≠ th√¨ g·ªçi h√†m <code class="language-plaintext highlighter-rouge">Choose_location()</code></li>
</ul>

<figure class="highlight"><pre><code class="language-c" data-lang="c"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
</pre></td><td class="code"><pre><span class="cm">/* Chon vi tri doc gia tri thoi tiet */</span>
<span class="kt">void</span> <span class="nf">Choose_location</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">lcd</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
  <span class="n">lcd</span><span class="p">.</span><span class="n">setCursor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
  <span class="n">lcd</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"Hold Mode Key &gt;= 1s "</span><span class="p">);</span>
  <span class="n">lcd</span><span class="p">.</span><span class="n">setCursor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
  <span class="n">lcd</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"TpHCM&gt; VgTau&gt; DaLat&gt;"</span><span class="p">);</span>
  <span class="n">lcd</span><span class="p">.</span><span class="n">setCursor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
  <span class="n">lcd</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"VgTau&gt; DaLat&gt; TpHue&gt;"</span><span class="p">);</span>
  <span class="n">lcd</span><span class="p">.</span><span class="n">setCursor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
  <span class="n">lcd</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"DaLat&gt; TpHue&gt; TpHCM&gt;"</span><span class="p">);</span>
  <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">dem_10s_stop</span> <span class="o">=</span> <span class="n">millis</span><span class="p">();</span>
  <span class="kt">int</span> <span class="n">dem_location</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">while</span> <span class="p">(((</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)(</span><span class="n">millis</span><span class="p">()</span> <span class="o">-</span> <span class="n">dem_10s_stop</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">10000</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">status_Mode</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))</span>
  <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">digitalRead</span><span class="p">(</span><span class="n">Button_Mode</span><span class="p">)</span> <span class="o">==</span> <span class="n">HIGH</span><span class="p">)</span> <span class="c1">// n·∫øu n√∫t b·∫•m ·ªü m·ª©c th·∫•p</span>
    <span class="p">{</span>
      <span class="n">delay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span> <span class="c1">//check chac chan la do ng nhan nut</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">digitalRead</span><span class="p">(</span><span class="n">Button_Mode</span><span class="p">)</span> <span class="o">==</span> <span class="n">HIGH</span><span class="p">)</span>
      <span class="p">{</span>
        <span class="kt">long</span> <span class="n">startTime</span> <span class="o">=</span> <span class="n">millis</span><span class="p">();</span>				 <span class="c1">// gi√° tr·ªã ban ƒë·∫ßu ƒë∆∞·ª£c g√°n b·∫±ng gi√° tr·ªã hi·ªán t·∫°i c·ªßa millis</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">digitalRead</span><span class="p">(</span><span class="n">Button_Mode</span><span class="p">)</span> <span class="o">==</span> <span class="n">HIGH</span><span class="p">)</span> <span class="c1">// ƒë·ª£i cho n√∫t b·∫•m ƒë∆∞·ª£c gi·ªØ</span>
        <span class="p">{</span>
          <span class="cm">/* khi nhan nut thi set lai time out mode */</span>
          <span class="n">dem_10s_stop</span> <span class="o">=</span> <span class="n">millis</span><span class="p">();</span>
          <span class="cm">/* check hanh vi nut nhan */</span>
          <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">millis</span><span class="p">()</span> <span class="o">-</span> <span class="n">startTime</span><span class="p">);</span>
          <span class="n">couter_Mode</span> <span class="o">=</span> <span class="p">(</span><span class="n">millis</span><span class="p">()</span> <span class="o">-</span> <span class="n">startTime</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">;</span>
          <span class="n">couter_Mode</span> <span class="o">=</span> <span class="n">couter_Mode</span> <span class="o">/</span> <span class="mi">1</span> <span class="o">%</span> <span class="mi">10</span><span class="p">;</span>
          <span class="n">lcd</span><span class="p">.</span><span class="n">setCursor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
          <span class="n">lcd</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"Couter: "</span><span class="p">);</span>
          <span class="n">lcd</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">couter_Mode</span><span class="p">);</span>
          <span class="n">lcd</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">" seconds  "</span><span class="p">);</span>
          <span class="k">if</span> <span class="p">(</span><span class="n">couter_Mode</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span>
          <span class="p">{</span>
          <span class="p">}</span>
          <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">couter_Mode</span> <span class="o">&gt;=</span> <span class="mi">9</span><span class="p">)</span>
          <span class="p">{</span>
            <span class="cm">/* mode xoay vong nen dem 1 den 9 thi reset */</span>
            <span class="n">startTime</span> <span class="o">=</span> <span class="n">millis</span><span class="p">();</span>
            <span class="n">lcd</span><span class="p">.</span><span class="n">setCursor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
            <span class="n">lcd</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"Loca:    Hue        "</span><span class="p">);</span>
            <span class="n">lcd</span><span class="p">.</span><span class="n">setCursor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
            <span class="n">lcd</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"         HCMC       "</span><span class="p">);</span>
            <span class="n">lcd</span><span class="p">.</span><span class="n">setCursor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
            <span class="n">lcd</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"         VungTau    "</span><span class="p">);</span>
          <span class="p">}</span>
          <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">couter_Mode</span> <span class="o">&gt;=</span> <span class="mi">7</span><span class="p">)</span>
          <span class="p">{</span>
            <span class="n">value_Location_EEPROM</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
            <span class="n">lcd</span><span class="p">.</span><span class="n">setCursor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
            <span class="n">lcd</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"Loca: &gt;&gt; Hue        "</span><span class="p">);</span>
            <span class="n">lcd</span><span class="p">.</span><span class="n">setCursor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
            <span class="n">lcd</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"         HCMC       "</span><span class="p">);</span>
            <span class="n">lcd</span><span class="p">.</span><span class="n">setCursor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
            <span class="n">lcd</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"         VungTau    "</span><span class="p">);</span>
          <span class="p">}</span>
          <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">couter_Mode</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">)</span>
          <span class="p">{</span>
            <span class="n">value_Location_EEPROM</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
            <span class="n">lcd</span><span class="p">.</span><span class="n">setCursor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
            <span class="n">lcd</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"Loca: &gt;&gt; DaLat      "</span><span class="p">);</span>
            <span class="n">lcd</span><span class="p">.</span><span class="n">setCursor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
            <span class="n">lcd</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"         Hue        "</span><span class="p">);</span>
            <span class="n">lcd</span><span class="p">.</span><span class="n">setCursor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
            <span class="n">lcd</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"         HCMC       "</span><span class="p">);</span>
          <span class="p">}</span>
          <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">couter_Mode</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">)</span>
          <span class="p">{</span>
            <span class="n">value_Location_EEPROM</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="n">lcd</span><span class="p">.</span><span class="n">setCursor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
            <span class="n">lcd</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"Loca: &gt;&gt; VungTau    "</span><span class="p">);</span>
            <span class="n">lcd</span><span class="p">.</span><span class="n">setCursor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
            <span class="n">lcd</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"         DaLat      "</span><span class="p">);</span>
            <span class="n">lcd</span><span class="p">.</span><span class="n">setCursor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
            <span class="n">lcd</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"         Hue        "</span><span class="p">);</span>
          <span class="p">}</span>
          <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">couter_Mode</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span>
          <span class="p">{</span>
            <span class="n">value_Location_EEPROM</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="n">lcd</span><span class="p">.</span><span class="n">setCursor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
            <span class="n">lcd</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"Loca: &gt;&gt; HCMC       "</span><span class="p">);</span>
            <span class="n">lcd</span><span class="p">.</span><span class="n">setCursor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
            <span class="n">lcd</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"         VungTau    "</span><span class="p">);</span>
            <span class="n">lcd</span><span class="p">.</span><span class="n">setCursor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
            <span class="n">lcd</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"         DaLat      "</span><span class="p">);</span>
          <span class="p">}</span>
          <span class="n">yield</span><span class="p">();</span> <span class="c1">// disble Soft WDT reset - NodeMCU</span>
        <span class="p">};</span>
        <span class="n">Serial</span><span class="p">.</span><span class="n">printf</span><span class="p">(</span><span class="s">"couter_Mode: "</span><span class="p">);</span>
        <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">couter_Mode</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">couter_Mode</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">{</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">couter_Mode</span> <span class="o">&gt;=</span> <span class="mi">7</span><span class="p">)</span>
        <span class="p">{</span>
          <span class="n">value_Location_EEPROM</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
          <span class="n">lcd</span><span class="p">.</span><span class="n">setCursor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
          <span class="n">lcd</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"Location Selection: "</span><span class="p">);</span>
          <span class="n">lcd</span><span class="p">.</span><span class="n">setCursor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
          <span class="n">lcd</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"         Hue        "</span><span class="p">);</span>
          <span class="n">lcd</span><span class="p">.</span><span class="n">setCursor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
          <span class="n">lcd</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"                    "</span><span class="p">);</span>
          <span class="n">lcd</span><span class="p">.</span><span class="n">setCursor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
          <span class="n">lcd</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"                    "</span><span class="p">);</span>
          <span class="n">customT</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
          <span class="n">delay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
          <span class="n">customP</span><span class="p">(</span><span class="mi">0</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
          <span class="n">delay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
          <span class="n">customH</span><span class="p">(</span><span class="mi">0</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
          <span class="n">delay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
          <span class="n">customU</span><span class="p">(</span><span class="mi">0</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
          <span class="n">delay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
          <span class="n">customE</span><span class="p">(</span><span class="mi">0</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
          <span class="n">delay</span><span class="p">(</span><span class="mi">800</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">couter_Mode</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">)</span>
        <span class="p">{</span>
          <span class="n">value_Location_EEPROM</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
          <span class="n">lcd</span><span class="p">.</span><span class="n">setCursor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
          <span class="n">lcd</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"Location Selection: "</span><span class="p">);</span>
          <span class="n">lcd</span><span class="p">.</span><span class="n">setCursor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
          <span class="n">lcd</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"       Dat Lat      "</span><span class="p">);</span>
          <span class="n">lcd</span><span class="p">.</span><span class="n">setCursor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
          <span class="n">lcd</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"                    "</span><span class="p">);</span>
          <span class="n">lcd</span><span class="p">.</span><span class="n">setCursor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
          <span class="n">lcd</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"                    "</span><span class="p">);</span>
          <span class="n">customD</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
          <span class="n">delay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
          <span class="n">customA</span><span class="p">(</span><span class="mi">0</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
          <span class="n">delay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
          <span class="n">customL</span><span class="p">(</span><span class="mi">0</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
          <span class="n">delay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
          <span class="n">customA</span><span class="p">(</span><span class="mi">0</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
          <span class="n">delay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
          <span class="n">customT</span><span class="p">(</span><span class="mi">0</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
          <span class="n">delay</span><span class="p">(</span><span class="mi">800</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">couter_Mode</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">)</span>
        <span class="p">{</span>
          <span class="n">value_Location_EEPROM</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
          <span class="n">lcd</span><span class="p">.</span><span class="n">setCursor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
          <span class="n">lcd</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"Location Selection: "</span><span class="p">);</span>
          <span class="n">lcd</span><span class="p">.</span><span class="n">setCursor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
          <span class="n">lcd</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"      Vung Tau      "</span><span class="p">);</span>
          <span class="n">lcd</span><span class="p">.</span><span class="n">setCursor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
          <span class="n">lcd</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"                    "</span><span class="p">);</span>
          <span class="n">lcd</span><span class="p">.</span><span class="n">setCursor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
          <span class="n">lcd</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"                    "</span><span class="p">);</span>
          <span class="n">customV</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
          <span class="n">delay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
          <span class="n">customG</span><span class="p">(</span><span class="mi">0</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
          <span class="n">delay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
          <span class="n">customT</span><span class="p">(</span><span class="mi">0</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
          <span class="n">delay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
          <span class="n">customA</span><span class="p">(</span><span class="mi">0</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
          <span class="n">delay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
          <span class="n">customU</span><span class="p">(</span><span class="mi">0</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
          <span class="n">delay</span><span class="p">(</span><span class="mi">800</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">couter_Mode</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">{</span>
          <span class="n">value_Location_EEPROM</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
          <span class="n">lcd</span><span class="p">.</span><span class="n">setCursor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
          <span class="n">lcd</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"Location Selection: "</span><span class="p">);</span>
          <span class="n">lcd</span><span class="p">.</span><span class="n">setCursor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
          <span class="n">lcd</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"        TPHCM       "</span><span class="p">);</span>
          <span class="n">lcd</span><span class="p">.</span><span class="n">setCursor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
          <span class="n">lcd</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"                    "</span><span class="p">);</span>
          <span class="n">lcd</span><span class="p">.</span><span class="n">setCursor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
          <span class="n">lcd</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"                    "</span><span class="p">);</span>
          <span class="n">customT</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
          <span class="n">delay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
          <span class="n">customP</span><span class="p">(</span><span class="mi">0</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
          <span class="n">delay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
          <span class="n">customH</span><span class="p">(</span><span class="mi">0</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
          <span class="n">delay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
          <span class="n">customC</span><span class="p">(</span><span class="mi">0</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
          <span class="n">delay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
          <span class="n">customM</span><span class="p">(</span><span class="mi">0</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
          <span class="n">delay</span><span class="p">(</span><span class="mi">800</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">yield</span><span class="p">();</span> <span class="c1">// disble Soft WDT reset - NodeMCU</span>
  <span class="p">}</span>
  <span class="cm">/* set lai gia tri cho su dung lan sau */</span>
  <span class="n">status_Mode</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="cm">/* luu gia tri vao eeprom */</span>
  <span class="n">EEPROM</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">index_eeprom_location_eeprom</span><span class="p">,</span> <span class="n">value_Location_EEPROM</span><span class="p">);</span>
  <span class="n">EEPROM</span><span class="p">.</span><span class="n">commit</span><span class="p">();</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"value_Location_EEPROM duoc set eeprom: "</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">EEPROM</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">index_eeprom_location_eeprom</span><span class="p">));</span>
  <span class="cm">/* Chu√¥ng b√°o ok */</span>
  <span class="n">digitalWrite</span><span class="p">(</span><span class="n">signal_Bell</span><span class="p">,</span> <span class="n">ESP_NB_ON</span><span class="p">);</span>
  <span class="n">delay</span><span class="p">(</span><span class="mi">300</span><span class="p">);</span>
  <span class="n">digitalWrite</span><span class="p">(</span><span class="n">signal_Bell</span><span class="p">,</span> <span class="n">ESP_NB_OFF</span><span class="p">);</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></figure>

<ul>
  <li>Tr∆∞·ªõc khi h√†m <code class="language-plaintext highlighter-rouge">Choose_location()</code> k·∫øt th√∫c v·ªã tr√≠ s·∫Ω ƒë∆∞·ª£c l∆∞u v√†o EEPROM v√† l∆∞u v√†o bi·∫øn <code class="language-plaintext highlighter-rouge">Location</code></li>
  <li>G·ªçi h√†m <code class="language-plaintext highlighter-rouge">Weather_Online_sever()</code> ƒë·ªÉ c·∫≠p nh·∫≠t th·ªùi ti·∫øt</li>
</ul>

<figure class="highlight"><pre><code class="language-c" data-lang="c"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
</pre></td><td class="code"><pre><span class="cm">/* Lay gia tri thoi tiet tai vi tri da chon */</span>
<span class="kt">void</span> <span class="nf">Weather_Online_sever</span><span class="p">()</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">value_Location_EEPROM</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">Location</span> <span class="o">=</span> <span class="s">"1566083"</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">value_Location_EEPROM</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">Location</span> <span class="o">=</span> <span class="s">"1562414"</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">value_Location_EEPROM</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">Location</span> <span class="o">=</span> <span class="s">"1584071"</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">value_Location_EEPROM</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">Location</span> <span class="o">=</span> <span class="s">"1565033"</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">WiFi</span><span class="p">.</span><span class="n">status</span><span class="p">()</span> <span class="o">==</span> <span class="n">WL_CONNECTED</span><span class="p">)</span> <span class="c1">//Check WiFi connection status</span>
  <span class="p">{</span>
    <span class="n">HTTPClient</span> <span class="n">http</span><span class="p">;</span> <span class="c1">//Declare an object of class HTTPClient</span>

    <span class="c1">// specify request destination</span>
    <span class="n">http</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="s">"http://api.openweathermap.org/data/2.5/weather?id="</span> <span class="o">+</span> <span class="n">Location</span> <span class="o">+</span> <span class="s">"&amp;APPID="</span> <span class="o">+</span> <span class="n">APIKey_openweather</span><span class="p">);</span>

    <span class="kt">int</span> <span class="n">httpCode</span> <span class="o">=</span> <span class="n">http</span><span class="p">.</span><span class="n">GET</span><span class="p">();</span> <span class="c1">// send the request</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">httpCode</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="c1">// check the returning code</span>
    <span class="p">{</span>
      <span class="n">String</span> <span class="n">payload</span> <span class="o">=</span> <span class="n">http</span><span class="p">.</span><span class="n">getString</span><span class="p">();</span> <span class="c1">//Get the request response payload</span>

      <span class="n">DynamicJsonBuffer</span> <span class="n">jsonBuffer</span><span class="p">(</span><span class="mi">512</span><span class="p">);</span>

      <span class="c1">// Parse JSON object</span>
      <span class="n">JsonObject</span> <span class="o">&amp;</span><span class="n">root</span> <span class="o">=</span> <span class="n">jsonBuffer</span><span class="p">.</span><span class="n">parseObject</span><span class="p">(</span><span class="n">payload</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">root</span><span class="p">.</span><span class="n">success</span><span class="p">())</span>
      <span class="p">{</span>
        <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="s">"Parsing failed !"</span><span class="p">));</span>
      <span class="p">}</span>

      <span class="n">temp</span> <span class="o">=</span> <span class="p">(</span><span class="kt">float</span><span class="p">)(</span><span class="n">root</span><span class="p">[</span><span class="s">"main"</span><span class="p">][</span><span class="s">"temp"</span><span class="p">])</span> <span class="o">-</span> <span class="mi">273</span><span class="p">.</span><span class="mi">15</span><span class="p">;</span>		 <span class="c1">// get temperature in ¬∞C</span>
      <span class="n">humidity</span> <span class="o">=</span> <span class="n">root</span><span class="p">[</span><span class="s">"main"</span><span class="p">][</span><span class="s">"humidity"</span><span class="p">];</span>				 <span class="c1">// get humidity in %</span>
      <span class="n">pressure</span> <span class="o">=</span> <span class="p">(</span><span class="kt">float</span><span class="p">)(</span><span class="n">root</span><span class="p">[</span><span class="s">"main"</span><span class="p">][</span><span class="s">"pressure"</span><span class="p">])</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">;</span> <span class="c1">// get pressure in bar</span>
      <span class="n">wind_speed</span> <span class="o">=</span> <span class="n">root</span><span class="p">[</span><span class="s">"wind"</span><span class="p">][</span><span class="s">"speed"</span><span class="p">];</span>					 <span class="c1">// get wind speed in m/s</span>
      <span class="n">wind_degree</span> <span class="o">=</span> <span class="n">root</span><span class="p">[</span><span class="s">"wind"</span><span class="p">][</span><span class="s">"deg"</span><span class="p">];</span>					 <span class="c1">// get wind degree in ¬∞</span>

      <span class="c1">// print data</span>
      <span class="n">Serial</span><span class="p">.</span><span class="n">printf</span><span class="p">(</span><span class="s">"Temperature = % .2f¬∞C</span><span class="se">\r\n</span><span class="s">"</span><span class="p">,</span> <span class="n">temp</span><span class="p">);</span>
      <span class="n">Serial</span><span class="p">.</span><span class="n">printf</span><span class="p">(</span><span class="s">"Humidity = % d % %</span><span class="se">\r\n</span><span class="s">"</span><span class="p">,</span> <span class="n">humidity</span><span class="p">);</span>
      <span class="c1">// Serial.printf("Pressure = % .3f bar\r\n", pressure);</span>
      <span class="c1">// Serial.printf("Wind speed = % .1f m / s\r\n", wind_speed);</span>
      <span class="c1">// Serial.printf("Wind degree = % d¬∞\r\n\r\n", wind_degree);</span>
    <span class="p">}</span>
    <span class="n">http</span><span class="p">.</span><span class="n">end</span><span class="p">();</span> <span class="c1">//Close connection</span>
    <span class="n">yield</span><span class="p">();</span>	<span class="c1">// disble Soft WDT reset - NodeMCU</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></figure>

<hr />

<p class="box-note"><strong>Note:</strong> Ph·∫ßn 3 ch√∫ng ta s·∫Ω l√†m vi·ªác v·ªõi c√°c Mode - S·ª≠ d·ª•ng m·ªôt n√∫t nh·∫•n cho nhi·ªÅu MODE</p>

:ET